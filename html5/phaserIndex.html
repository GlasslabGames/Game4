<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Creature Caretaker</title>
    <script src="phaser/build/phaser.js"></script>
    <script src="js/src/AE.js"></script>
    <script type="text/javascript">
        // create a new loader
        //loader = new PIXI.AssetLoader(assetsToLoader);

        // use callback
        //loader.onComplete = onAssetsLoaded;

        //begin load
        //loader.load();
        var global = {};

        window.onload = function() {
            var game = new Phaser.Game(800, 600, Phaser.AUTO, 'gameContainer', { preload: preload, create: create, update: update});
            var spineAnimation;
            function preload() {
                game.load.xml('consebot2anim', "assets/animations/consebot/consequenceBotEvo2_attack.xml")
                game.load.image('disk', 'assets/images/copy-that-floppy.png');
                game.load.image('1UP', 'assets/images/mushroom2.png');

            }

            var parent;
            var child;
            var child2;
            var dragObject;
            var dragOrigin;
            function conseClick()
            {
                console.log("TEST");
            };

            function create()
            {
                var asset = game.cache.getXML('consebot2anim');
                var conseBotData = new AE.Data(asset);

                for (var asset in conseBotData.requiredAssets)
                {
                    conseBotData.requiredAssets[asset] = false;
                    game.load.image(asset, "assets/animations/consebot/"+asset);
                }
                game.load.onLoadComplete.add(function(index){
                    console.log("Consebot Assets Load Complete.");

                    var animation = new AE.Animation(conseBotData, game);

                    animation.gameObject.inputEnabled = true;
                    animation.gameObject.events.onInputDown.add(conseClick, this);
                    animation.gameObject.events.onInputUp.add(onUp, this);
                    animation.gameObject.events.onInputDown.add(onDown, this);

                    global.animation = animation;
                });

                game.load.start();

                parent = game.add.sprite(100, 100, 'disk');
                parent.inputEnabled = true;
                parent.anchor.x = parent.anchor.y = .5;
                parent.name = 'disk';
                parent.events.onInputUp.add(onUp, this);
                parent.events.onInputDown.add(onDown, this);

                child = game.make.sprite(0, 0, '1UP');
                child.name = "1UP";
                child.anchor.x = child.anchor.y = .5;
                child.x = 200;
                child.y = 50;
                child.inputEnabled = true;
                child.input.priorityID = 1;
                child.events.onInputUp.add(onUp, this);
                child.events.onInputDown.add(onDown, this);
                parent.addChild(child);

                child2 = game.make.sprite(0, 0, '1UP');
                child2.name = "1UP";
                child2.anchor.x = child2.anchor.y = .5;
                child2.x = 50;
                child2.y = 250;
                child2.inputEnabled = true;
                child2.input.priorityID = 2;
                child2.events.onInputUp.add(onUp, this);
                child2.events.onInputDown.add(onDown, this);
                child.addChild(child2);

                game.add.text(250, 250, "Awesome", { fill:"#fff" }).name = "Text";
            }

            function update()
            {
                if (dragObject)
                {
                    var localPoint = dragObject.toLocal(new PIXI.Point(game.input.worldX, game.input.worldY));
                    dragObject.x += localPoint.x;
                    dragObject.y += localPoint.y;
                }

                if (global.animation)
                {
                    global.animation.update();
                }
            }

            function onDown(sprite, pointer)
            {
                dragObject = sprite;
                dragOrigin = new PIXI.Point(pointer.screenX, pointer.screenY);
            }

            function onUp(sprite, pointer)
            {
                dragObject = null;
                dragOrigin.subtract(pointer.screenX, pointer.screenY);
                if (dragOrigin.getMagnitudeSq() <= 1)
                {
                    var o = sprite;
                    if (o.scale.x == 2)
                        o.scale.x = 1;
                    else
                        o.scale.x = 2;
                }
            }
        };
    </script>
</head>
<body>

<div id="gameContainer"></div>

</body>
</html>